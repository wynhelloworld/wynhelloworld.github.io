# Redis 主从复制

Redis 主从复制，是指将一台 Redis 服务器上的数据，复制到其它 Redis 服务器上。前者称为主节点（Master），后者称为从节点（Slave）。

主节点上的数据会同步给从节点，而从节点不能同步给主节点。也就是说主节点能够进行读写，而从节点只能进行读（当然通过配置文件也可以修改成可写）。所以，Redis 主从复制的作用是体现在了读操作上，而不是写操作上。

## 主从复制的作用

当只有一台 Redis 服务器时，会容易出现以下问题：

- 当 Redis 服务器达到性能瓶颈时，会暂时无法处理新的命令请求。
- 当 Redis 服务器宕机时，由于数据恢复需要时间，在此期间，也无法处理新的命令请求。
- 当 Redis 服务器硬盘出现故障时，会导致数据丢失。

主从复制就解决了上述问题。主节点将数据同步到从节点上，配合负载均衡，能大大降低主节点的压力。即使其中的某个节点挂掉，也不会中断整个服务。即使其中的某个节点硬盘出现故障，也不会导致整个服务的数据丢失。

## 在单服务器上构建 Redis 主从复制

通过配置文件修改端口号，使之能够运行起多个 Redis 服务器。以下命令创建了一个配置文件，能运行一个从节点。

```shell
sudo cp /etc/redis/redis.conf /etc/redis/slave6380.conf
```

然后对两个配置文件分别进行编辑，加上以下内容：

```shell
slaveof 127.0.0.1 6379
```

修改以下内容：

```shell
port 6380
daemonize yes
```

启动从节点

```shell
redis-cli /etc/redis/slave6380.conf
```

## 查看主从结构信息

通过 `info replication` 命令可查看主从结构信息，信息如下（左边是主节点，右边是从节点）：

![image-20231123214823945](https://wyn-personal-picture.oss-cn-beijing.aliyuncs.com/img/image-20231123214823945.png)

